msg_qam_extension=[msg_qam']'
Io=real(msg_qam);
Qo=imag(msg_qam);
I=real(msg_qam_extension);
Q=imag(msg_qam_extension);

fsb=250;              %符号采样频率
db=1/fsb;      		  %s  %采样间隔
Tb=db*(E/Qm);     	  %us %观测时间
tb=0:db:Tb-db;    	  %离散时间t

fsrcc=500;            %滤波器采样频率
drcc =1/fsrcc;        %s  %采样间隔
rolloff=0.001;          %滤波器滚降系数
N = 100               %阶数
sps = fsrcc/(2*fsb)
span = N/sps; 
Trrc=drcc*((E/Qm)+span);%us %观测时间
trcc=0:drcc:Trrc-drcc;%离散时间t
%$$$$$$$$$$$$$$$$$$$$$$$$$--nyqfir rcosine--$$$$$$$$$$$$$$$$$$$$$$$$$$$
delay=20;        	  %滤波器时延
[num,den]=rcosine(fsb,fsrcc,'default',rolloff,delay); %设计滤波器
figure(1); impz(num,1);    %滤波器的冲激响应
fvtool(num,den);    %滤波器的冲激响应
%$$$$$$$$$$$$$$$$$$$$$$$$$--transmit
[I_trrc,titrrc]=rcosflt(I,fsb,fsrcc,'filter',num,den);   %
[Q_trrc,tqtrrc]=rcosflt(Q,fsb,fsrcc,'filter',num,den);   %

figure(3)
subplot(4,2,1);	%画图 
plot(tb,I);xlabel('tb');title('I');%画I的原始波形
subplot(4,2,2);	%画图 
plot(tb,Q);xlabel('tb');title('Q');%画Q的原始波形
subplot(4,2,3);	%画图 
plot(titrrc,I_trrc);xlabel('titrrc');title('I_trrc');%画I的原始波形
subplot(4,2,4);	%画图 
plot(tqtrrc,Q_trrc);xlabel('tqtrrc');title('Q_trrc');%画Q的原始波形
%$$$$$$$$$$$$$$$$$$$$$$$$$--FFT
% dfsb=fsb/length(tb);
% fb=-fsb/2:dfsb:fsb/2-dfsb;
% FI=fft(I)/fsb;
% FQ=fft(Q)/fsb;
% subplot(4,2,5);%画图
% stem(fb,fftshift(abs(FI)));xlabel('频率fb');title('FI的幅度谱');%画原始波形I的幅度谱
% subplot(4,2,6);%画图
% stem(fb,fftshift(abs(FQ)));xlabel('频率fb');title('FQ的幅度谱');%画原始波形I的幅度谱

% dfsrcc=fsrcc/length(titrrc);
% frcc=-fsrcc/2:dfsrcc:fsrcc/2-dfsrcc;
% FIrrc=fft(I_trrc)/fsrcc;
% FQrrc=fft(Q_trrc)/fsrcc;
% subplot(4,2,7);%画图
% stem(frcc,fftshift(abs(FIrrc)));xlabel('频率frcc');title('FIrrc的幅度谱');%画原始波形Irrc的幅度谱
% subplot(4,2,8);%画图
% stem(frcc,fftshift(abs(FQrrc)));xlabel('频率frcc');title('FQrrc的幅度谱');%画原始波形Qrrc的幅度谱
% msg_qam_loop=complex(I_trrc,-Q_trrc)';
% scatterplot(msg_qam_loop)
% $$$$$$$$$$$$$$$$$$$$$$$$$--fir
Num_decimation=[-9.25747896163374e-05	0.000104520413468063	0.000546779288111408	0.000771053032433759	0.000389491527277245	-0.000172565843839707	-0.000218262904546600	0.000132495027177200	0.000185162923041453	-0.000115384284327978	-0.000165179774094186	0.000116821739289369	0.000156216079154321	-0.000125182882021742	-0.000152972425376815	0.000137383094095917	0.000152913682311109	-0.000152182971306413	-0.000154686002476440	0.000169044952194628	0.000157321705593534	-0.000187858096210814	-0.000160344106492033	0.000208409278601279	0.000163188721051232	-0.000230769237612377	-0.000165595267771907	0.000254917153858419	0.000167210598172606	-0.000280913447360188	-0.000167798377123156	0.000308736536778255	0.000167079107396769	-0.000338425807068712	-0.000164868628000237	0.000369890921436465	0.000160831038004335	-0.000403186659859824	-0.000154797803959175	0.000438195758933810	0.000146427844923768	-0.000474955852386009	-0.000135550043954073	0.000513291019640885	0.000121795909981185	-0.000553216538847543	-0.000105003133498650	0.000594532488257726	8.48435848325094e-05	-0.000637171870225244	-6.11210830459145e-05	0.000680931173139282	3.35724751339680e-05	-0.000725585774255260	-1.87744638839462e-06	0.000770955047352446	-3.41817745385914e-05	-0.000816709444098810	7.50437669508736e-05	0.000862850863471220	-0.000120624119940750	-0.000908727594592797	0.000171552513982385	0.000954452373872683	-0.000227575299818724	-0.000999202011039046	0.000289294226855793	0.00104275760721783	-0.000357007637174423	-0.00108500981742321	0.000430530881707928	0.00112519204501582	-0.000510219277761435	-0.00116287171074075	0.000596309280448419	0.00119766647652476	-0.000688846532571664	-0.00122902370002124	0.000787946310160417	0.00125635903571050	-0.000893762346703549	-0.00127920272899839	0.00100624483217743	0.00129685698058641	-0.00112545129495134	-0.00130863443911252	0.00125152590893398	0.00131404292828709	-0.00138430150887345	-0.00131233877590540	0.00152371922805070	0.00130274807038691	-0.00166979171099504	-0.00128467878196012	0.00182224390644624	0.00125720082230336	-0.00198109812546351	-0.00121971489635720	0.00214601574696727	0.00117129612706075	-0.00231684566805410	-0.00111117728683379	0.00249326162484779	0.00103841654207016	-0.00267501883669673	-0.000952146801917462	0.00286178670086721	0.000851446078258273	-0.00305316762903964	-0.000735309111946215	0.00324881065771912	0.000602773199900231	-0.00344819356512223	-0.000452664203366596	0.00365095432363359	0.000283919786920668	-0.00385650720368467	-9.52201902315510e-05	0.00406444269321176	-0.000114640593110270	-0.00427408824173826	0.000347206436390848	0.00448497721880379	-0.000603976070343952	-0.00469646806459886	0.000886703833948595	0.00490796334635741	-0.00119734036101307	-0.00511885500545550	0.00153804319813658	0.00532847970405669	-0.00191131922003983	-0.00553612003077004	0.00232017867544740	0.00574125218622461	-0.00276790298806491	-0.00594311064336743	0.00325858694379361	0.00614108804857497	-0.00379703773738152	-0.00633456120102110	0.00438898771092063	0.00652277296570926	-0.00504157085542646	-0.00670473243707872	0.00576439088336345	0.00688071256890887	-0.00656795701597110	-0.00705003859026525	0.00746564145333457	0.00721008305937453	-0.00847878045834573	-0.00736290134991413	0.00962997105598733	0.00750641997083863	-0.0109537415369643	-0.00764092607551356	0.0124957628164697	0.00776543197633628	-0.0143223309569463	-0.00787949369980027	0.0165308396640427	0.00798266659920524	-0.0192709188478595	-0.00807457114216050	0.0227845857474622	0.00815498375921597	-0.0274900791286966	-0.00822350820773392	0.0341782576631689	0.00828001534570181	-0.0445442476242810	-0.00832417659392584	0.0629968952689945	0.00835589929070277	-0.105703513725248	-0.00837497155893391	0.318176517108418	0.508381365377279	0.318176517108418	-0.00837497155893391	-0.105703513725248	0.00835589929070277	0.0629968952689945	-0.00832417659392584	-0.0445442476242810	0.00828001534570181	0.0341782576631689	-0.00822350820773392	-0.0274900791286966	0.00815498375921597	0.0227845857474622	-0.00807457114216050	-0.0192709188478595	0.00798266659920524	0.0165308396640427	-0.00787949369980027	-0.0143223309569463	0.00776543197633628	0.0124957628164697	-0.00764092607551356	-0.0109537415369643	0.00750641997083863	0.00962997105598733	-0.00736290134991413	-0.00847878045834573	0.00721008305937453	0.00746564145333457	-0.00705003859026525	-0.00656795701597110	0.00688071256890887	0.00576439088336345	-0.00670473243707872	-0.00504157085542646	0.00652277296570926	0.00438898771092063	-0.00633456120102110	-0.00379703773738152	0.00614108804857497	0.00325858694379361	-0.00594311064336743	-0.00276790298806491	0.00574125218622461	0.00232017867544740	-0.00553612003077004	-0.00191131922003983	0.00532847970405669	0.00153804319813658	-0.00511885500545550	-0.00119734036101307	0.00490796334635741	0.000886703833948595	-0.00469646806459886	-0.000603976070343952	0.00448497721880379	0.000347206436390848	-0.00427408824173826	-0.000114640593110270	0.00406444269321176	-9.52201902315510e-05	-0.00385650720368467	0.000283919786920668	0.00365095432363359	-0.000452664203366596	-0.00344819356512223	0.000602773199900231	0.00324881065771912	-0.000735309111946215	-0.00305316762903964	0.000851446078258273	0.00286178670086721	-0.000952146801917462	-0.00267501883669673	0.00103841654207016	0.00249326162484779	-0.00111117728683379	-0.00231684566805410	0.00117129612706075	0.00214601574696727	-0.00121971489635720	-0.00198109812546351	0.00125720082230336	0.00182224390644624	-0.00128467878196012	-0.00166979171099504	0.00130274807038691	0.00152371922805070	-0.00131233877590540	-0.00138430150887345	0.00131404292828709	0.00125152590893398	-0.00130863443911252	-0.00112545129495134	0.00129685698058641	0.00100624483217743	-0.00127920272899839	-0.000893762346703549	0.00125635903571050	0.000787946310160417	-0.00122902370002124	-0.000688846532571664	0.00119766647652476	0.000596309280448419	-0.00116287171074075	-0.000510219277761435	0.00112519204501582	0.000430530881707928	-0.00108500981742321	-0.000357007637174423	0.00104275760721783	0.000289294226855793	-0.000999202011039046	-0.000227575299818724	0.000954452373872683	0.000171552513982385	-0.000908727594592797	-0.000120624119940750	0.000862850863471220	7.50437669508736e-05	-0.000816709444098810	-3.41817745385914e-05	0.000770955047352446	-1.87744638839462e-06	-0.000725585774255260	3.35724751339680e-05	0.000680931173139282	-6.11210830459145e-05	-0.000637171870225244	8.48435848325094e-05	0.000594532488257726	-0.000105003133498650	-0.000553216538847543	0.000121795909981185	0.000513291019640885	-0.000135550043954073	-0.000474955852386009	0.000146427844923768	0.000438195758933810	-0.000154797803959175	-0.000403186659859824	0.000160831038004335	0.000369890921436465	-0.000164868628000237	-0.000338425807068712	0.000167079107396769	0.000308736536778255	-0.000167798377123156	-0.000280913447360188	0.000167210598172606	0.000254917153858419	-0.000165595267771907	-0.000230769237612377	0.000163188721051232	0.000208409278601279	-0.000160344106492033	-0.000187858096210814	0.000157321705593534	0.000169044952194628	-0.000154686002476440	-0.000152182971306413	0.000152913682311109	0.000137383094095917	-0.000152972425376815	-0.000125182882021742	0.000156216079154321	0.000116821739289369	-0.000165179774094186	-0.000115384284327978	0.000185162923041453	0.000132495027177200	-0.000218262904546600	-0.000172565843839707	0.000389491527277245	0.000771053032433759	0.000546779288111408	0.000104520413468063	-9.25747896163374e-05]
b_nyq_fir=Num_decimation;	%Num为滤波器系统在workspace的存储单元
a=1;
I_LPfir=filter(b_nyq_fir,a,I_trrc);
Q_LPfir=filter(b_nyq_fir,a,Q_trrc);
figure(4)
subplot(2,2,1);	%画图 
plot(titrrc,I_LPfir);xlabel('t');title('I_LPfir');%画经过LPfir的I波形
subplot(2,2,2);	%画图 
plot(tqtrrc,Q_LPfir);xlabel('t');title('Q_LPfir');%画经过LPfir的Q波形







