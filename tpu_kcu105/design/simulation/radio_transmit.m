%来自layer1的符号
msg_qam_extension=[msg_qam',msg_qam']'
Io=real(msg_qam);
Qo=imag(msg_qam);
I=real(msg_qam_extension);
Q=imag(msg_qam_extension);
fs=250*10^6;    %250MHz %采样频率
d=1/fs;      	%s  %采样间隔
T=2*(d*(E/Qm)); %us %观测时间
t=0:d:T-d;    	%离散时间t
figure(1)
subplot(6,2,1);	%画图 
plot(t,I);xlabel('t');title('I');%画I的原始波形
subplot(6,2,2);	%画图 
plot(t,Q);xlabel('t');title('Q');%画Q的原始波形
%$$$$$$$$$$$$$$$$$$$$$$$$$--nyqfir--$$$$$$$$$$$$$$$$$$$$$$$$$$$
Num_nyq_fir=[-4.83861289421844e-05	0.000136677375459635	-0.000316543256816017	0.000634050607879113	-0.00114984429456827	0.00193450114075664	-0.00306469876983719	0.00461745573464203	-0.00666266998518887	0.00925463294799435	-0.0124230848173747	0.0161650885982404	-0.0204384350766706	0.0251579196762951	-0.0301950448459117	0.0353818120952225	-0.0405185682069315	0.0453856232230121	-0.0497577374141365	0.0534202139674820	-0.0561851487000087	0.0579062139052514	0.941509481965946	0.0579062139052514	-0.0561851487000087	0.0534202139674820	-0.0497577374141365	0.0453856232230121	-0.0405185682069315	0.0353818120952225	-0.0301950448459117	0.0251579196762951	-0.0204384350766706	0.0161650885982404	-0.0124230848173747	0.00925463294799435	-0.00666266998518887	0.00461745573464203	-0.00306469876983719	0.00193450114075664	-0.00114984429456827	0.000634050607879113	-0.000316543256816017	0.000136677375459635	-4.83861289421844e-05]
b_nyq_fir=Num_nyq_fir;	%Num为滤波器系统在workspace的存储单元
a=1;
I_nyqfir=filter(b_nyq_fir,a,I);
Q_nyqfir=filter(b_nyq_fir,a,Q);
subplot(6,2,3);	%画图 
plot(t,I_nyqfir);xlabel('t');title('I_nyqfir');%画经过nyqfir的I波形
subplot(6,2,4);	%画图 
plot(t,Q_nyqfir);xlabel('t');title('Q_nyqfir');%画经过nyqfir的Q波形
%$$$$$$$$$$$$$$$$$$$$$$--interpolation--$$$$$$$$$$$$$$$$$$$$$$$$
t1=0:d/2:T-d/2;     %离散时间t
[t1x,t1y]=size(t1);
I_interpolation=zeros(t1x,t1y);
Q_interpolation=zeros(t1x,t1y);
for i=1:t1y
ii = mod(i,2);
		if (ii==1)
			I_interpolation(i)=0;
			Q_interpolation(i)=0;
		else
			I_interpolation(i)=I_nyqfir(i/2);
			Q_interpolation(i)=Q_nyqfir(i/2);
		end
	end
subplot(6,2,5);%画图  
plot(t1,I_interpolation);xlabel('t1');title('I_interpolation');%画内插后的函数图
subplot(6,2,6);%画图  
plot(t1,Q_interpolation);xlabel('t1');title('Q_interpolation');%画内插后的函数图
Num_interpolation=[-0.000258858058206960	-0.000330393739936240	0.000244803877996572	0.00108127180581042	0.000946158475308332	-0.000301488964037976	-0.000875330781623297	0.000356849303536685	0.00148752989497094	0.000215986091427487	-0.00180795395128458	-0.000921593577544323	0.00203279253864274	0.00195291371085818	-0.00188288807505977	-0.00315132687430823	0.00126808235717264	0.00440850449383729	-5.28913866913680e-05	-0.00550439680959660	-0.00181429575227560	0.00618223367745800	0.00431651532713280	-0.00614411769661609	-0.00733634199367101	0.00508144326490152	0.0106460494933085	-0.00270101496581898	-0.0139042656372629	-0.00125647616795596	0.0166533671452492	0.00700724009280437	-0.0183187127122656	-0.0147576995221823	0.0181707493714565	0.0248055356409143	-0.0151927518381425	-0.0378352245491180	0.00762406840564322	0.0558576929047605	0.00883319743195283	-0.0863040116935435	-0.0515872561274440	0.178597799923957	0.416010623624409	0.416010623624409	0.178597799923957	-0.0515872561274440	-0.0863040116935435	0.00883319743195283	0.0558576929047605	0.00762406840564322	-0.0378352245491180	-0.0151927518381425	0.0248055356409143	0.0181707493714565	-0.0147576995221823	-0.0183187127122656	0.00700724009280437	0.0166533671452492	-0.00125647616795596	-0.0139042656372629	-0.00270101496581898	0.0106460494933085	0.00508144326490152	-0.00733634199367101	-0.00614411769661609	0.00431651532713280	0.00618223367745800	-0.00181429575227560	-0.00550439680959660	-5.28913866913680e-05	0.00440850449383729	0.00126808235717264	-0.00315132687430823	-0.00188288807505977	0.00195291371085818	0.00203279253864274	-0.000921593577544323	-0.00180795395128458	0.000215986091427487	0.00148752989497094	0.000356849303536685	-0.000875330781623297	-0.000301488964037976	0.000946158475308332	0.00108127180581042	0.000244803877996572	-0.000330393739936240	-0.000258858058206960]
b_interpolation=Num_interpolation;	%Num为滤波器系统在workspace的存储单元
I_interpolation_fir=filter(b_interpolation,a,I_interpolation);
Q_interpolation_fir=filter(b_interpolation,a,Q_interpolation);
subplot(6,2,7);%画图  
plot(t1,I_interpolation_fir);xlabel('t1');title('I_interpolation_fir');%滤波后的函数图
subplot(6,2,8);%画图  
plot(t1,Q_interpolation_fir);xlabel('t1');title('Q_interpolation_fir');%滤波后的函数图
%$$$$$$$$$$$$$$$$$$$$$$$$$--DUC--$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
Ac=1;           		%amplify
fc=50*10^6;   			%50MHz
wc=2*pi*fc;         	%rad/s
pc=0;               	%rad
%采样
fsc=2*fs;    			%采样频率
dc=1/fsc;             	%s采样间隔
tc=0:dc:T-dc;       	%离散时间t

Csin=Ac*sin(wc*tc+pc);  	%载波正弦信号
Ccos=Ac*cos(wc*tc+pc);  	%载波余弦信号
subplot(6,2,9);%画图
plot(tc,Ccos);xlabel('tc');title('Ccos');%画载波余弦信号
subplot(6,2,10);%画图
plot(tc,Csin);xlabel('tc');title('Csin');%画载波正弦信号
%cos(a+b)=cosacosb-sinasinb
%sin(a+b)=sinacosb+cosasinb
Cacos=I_interpolation_fir.*Ccos-Q_interpolation_fir.*Csin; 	%DUC后Ca余弦信号
Casin=Q_interpolation_fir.*Ccos+I_interpolation_fir.*Csin; 	%DUC后Ca正弦信号
subplot(6,2,11);%画图 
plot(tc,Cacos);xlabel('tc');title('Cacos');%画DUC余弦信号
subplot(6,2,12);%画图 
plot(tc,Casin);xlabel('tc');title('Casin');%画DUC正弦信号